---
/* vibepedia 記事ページ
 * Markdownファイルから記事コンテンツを動的に生成する。
 * slug（日本語タイトル）をURLパスとして使用する。
 */
import Layout from '../../layouts/Layout.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const articles = await getCollection('articles');
  return articles.map((article) => ({
    params: { slug: article.data.slug ?? article.id },
    props: { article },
  }));
}

const { article } = Astro.props;
const { Content, headings } = await render(article);
const base = import.meta.env.BASE_URL;

/* 日付フォーマット */
const formatDate = (date: Date) =>
  date.toLocaleDateString('ja-JP', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
---

<Layout
  title={article.data.title}
  description={article.data.description}
  ogImage={article.data.image}
  headings={headings}
  isArticle={true}
>
  <article class="article">
    <!-- 記事ヘッダー -->
    <header class="article-header">
      <div class="article-category-badge">{article.data.category}</div>
      <h1 class="article-title">{article.data.title}</h1>
      <p class="article-description">{article.data.description}</p>
      <div class="article-meta">
        <span class="meta-item">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          作成: {formatDate(article.data.date)}
        </span>
        <span class="meta-item">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="23 4 23 10 17 10"></polyline>
            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
          </svg>
          最終更新: {formatDate(article.data.lastmod)}
        </span>
      </div>
    </header>

    {/* 記事サムネイル画像 */}
    {article.data.image && (
      <figure class="article-figure">
        <img
          src={article.data.image}
          alt={article.data.title}
          class="article-image"
          loading="eager"
        />
      </figure>
    )}

    <!-- Markdownコンテンツのレンダリング -->
    <div class="article-content">
      <Content />
    </div>

    <!-- 記事フッター -->
    <footer class="article-footer">
      <a href={base} class="back-link">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
        メインページに戻る
      </a>
    </footer>
  </article>
</Layout>

<style>
  .article {
    max-width: 100%;
  }

  /* 記事ヘッダー */
  .article-header {
    margin-bottom: var(--spacing-xl);
    padding-bottom: var(--spacing-lg);
    border-bottom: 1px solid var(--color-border-light);
  }

  .article-category-badge {
    display: inline-block;
    padding: 2px 10px;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--color-accent);
    background-color: #e8f4fd;
    border-radius: 12px;
    margin-bottom: var(--spacing-sm);
  }

  .article-title {
    font-size: 2rem;
    font-weight: 700;
    line-height: 1.2;
    color: var(--color-text);
    margin-bottom: var(--spacing-sm);
    letter-spacing: -0.02em;
  }

  .article-description {
    font-size: 1rem;
    line-height: 1.6;
    color: var(--color-text-secondary);
    margin-bottom: var(--spacing-md);
  }

  .article-meta {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-md);
  }

  .meta-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    font-size: 0.8125rem;
    color: var(--color-text-tertiary);
  }

  .meta-item svg {
    flex-shrink: 0;
  }

  /* 記事画像 */
  .article-figure {
    margin: 0 0 var(--spacing-xl);
    border-radius: var(--radius-md);
    overflow: hidden;
    border: 1px solid var(--color-border-light);
  }

  .article-image {
    width: 100%;
    max-height: 400px;
    object-fit: cover;
  }

  /* 記事フッター */
  .article-footer {
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-lg);
    border-top: 1px solid var(--color-border-light);
  }

  .back-link {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-size: 0.875rem;
    color: var(--color-link);
    text-decoration: none;
    padding: var(--spacing-sm) var(--spacing-md);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    transition: all var(--transition-fast);
  }

  .back-link:visited {
    color: var(--color-link);
  }

  .back-link:hover {
    background-color: var(--color-sidebar-bg);
    text-decoration: none;
  }

  @media (max-width: 768px) {
    .article-title {
      font-size: 1.5rem;
    }

    .article-meta {
      flex-direction: column;
      gap: var(--spacing-xs);
    }
  }
</style>
